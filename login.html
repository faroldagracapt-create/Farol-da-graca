<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrar | Farol da Graça</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import { AuthService } from './auth.js';

        // Toggle Login/Register
        const params = new URLSearchParams(window.location.search);
        const mode = params.get('mode');
        const isRegister = mode === 'register';

        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const toggleText = document.getElementById('toggle-text');
        const nameField = document.getElementById('name-field');
        const churchField = document.getElementById('church-field');

        if (isRegister) {
            if(formTitle) formTitle.textContent = 'Criar Conta';
            if(submitBtn) submitBtn.textContent = 'Registar';
            if(toggleText) toggleText.innerHTML = 'Já tem conta? <a href="login.html" class="text-blue-700 font-bold hover:underline">Entrar</a>';
            if(nameField) nameField.classList.remove('hidden');
            if(churchField) churchField.classList.remove('hidden');
        }

        // Handle Submit
        document.getElementById('auth-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (isRegister) {
                const name = document.getElementById('name').value;
                const church = document.getElementById('church').value;
                const res = AuthService.register(name, email, password, church);
                if (res.success) {
                    window.location.href = 'dashboard.html';
                } else {
                    alert(res.message);
                }
            } else {
                const res = AuthService.login(email, password);
                if (res.success) {
                    window.location.href = res.user.role === 'admin' ? 'admin.html' : 'dashboard.html';
                } else {
                    alert(res.message);
                }
            }
        });
    </script>
</head>
<body class="bg-azulejo min-h-screen flex items-center justify-center p-6">

    <div class="bg-white max-w-md w-full rounded-2xl shadow-2xl overflow-hidden border-azulejo fade-in-up">
        <div class="bg-blue-700 p-8 text-center relative overflow-hidden">
            <div class="absolute inset-0 bg-[url('https://r2.flowith.net/files/jpeg/NDR3H-portuguese_sea_lighthouse_dawn_index_1@1024x1024.jpeg')] opacity-20 bg-cover bg-center"></div>
            <a href="index.html" class="relative z-10 inline-block p-3 bg-white/10 backdrop-blur rounded-full mb-4 border border-white/20">
                <i data-lucide="lighthouse" class="w-8 h-8 text-white"></i>
            </a>
            <h1 id="form-title" class="relative z-10 text-3xl font-bold text-white font-serif">Bem-vindo ao Porto</h1>
            <p class="relative z-10 text-blue-100 mt-2">Acesso restrito a pastores e líderes.</p>
        </div>

        <form id="auth-form" class="p-8 space-y-5">
            <div id="name-field" class="hidden space-y-1">
                <label class="text-sm font-bold text-gray-600">Nome Completo</label>
                <input type="text" id="name" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" placeholder="Ex: João Silva">
            </div>

            <div id="church-field" class="hidden space-y-1">
                <label class="text-sm font-bold text-gray-600">Igreja / Organização</label>
                <input type="text" id="church" class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" placeholder="Ex: Igreja Baptista de Lisboa">
            </div>

            <div class="space-y-1">
                <label class="text-sm font-bold text-gray-600">Email</label>
                <input type="email" id="email" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" placeholder="pastor@exemplo.pt">
            </div>

            <div class="space-y-1">
                <label class="text-sm font-bold text-gray-600">Palavra-passe</label>
                <input type="password" id="password" required class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" placeholder="********">
            </div>

            <button type="submit" id="submit-btn" class="w-full py-4 bg-blue-700 text-white font-bold rounded-lg shadow-lg hover:bg-blue-800 transition transform active:scale-95">
                Entrar
            </button>

            <p id="toggle-text" class="text-center text-sm text-gray-500">
                Ainda não tem conta? <a href="login.html?mode=register" class="text-blue-700 font-bold hover:underline">Registar</a>
            </p>
        </form>
        
        <div class="px-8 pb-8 text-center">
             <p class="text-xs text-gray-400 mt-4 leading-relaxed">
                Ao entrar, concorda com a nossa Política de Privacidade. Os seus dados são confidenciais e protegidos sob a lei portuguesa e o RGPD.
            </p>
        </div>
    </div>

</body>
</html>
